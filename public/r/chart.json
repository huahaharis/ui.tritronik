{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "chart",
  "dependencies": [
    "chart.js",
    "react-chartjs-2"
  ],
  "registryDependencies": [
    "utils"
  ],
  "files": [
    {
      "path": "src/components/ui/unified-chart.tsx",
      "content": "\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport {\r\n  Chart as ChartJS,\r\n  CategoryScale,\r\n  LinearScale,\r\n  PointElement,\r\n  LineElement,\r\n  BarElement,\r\n  ArcElement,\r\n  Title,\r\n  Tooltip,\r\n  Legend,\r\n  Filler,\r\n  ChartData,\r\n  ChartOptions,\r\n  TooltipItem\r\n} from \"chart.js\"\r\nimport { Bar, Line, Pie } from \"react-chartjs-2\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst THEMES = { light: '', dark: '.dark' } as const\r\n\r\nexport type ChartConfig = {\r\n  [k in string]: {\r\n    label?: React.ReactNode\r\n    icon?: React.ComponentType\r\n  } & (\r\n    | { color?: string; theme?: never }\r\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\r\n  )\r\n}\r\n\r\nChartJS.register(\r\n  CategoryScale,\r\n  LinearScale,\r\n  PointElement,\r\n  LineElement,\r\n  BarElement,\r\n  ArcElement,\r\n  Title,\r\n  Tooltip,\r\n  Legend,\r\n  Filler\r\n)\r\n\r\nexport type ChartType = \"bar\" | \"line\" | \"pie\" | \"area\"\r\n\r\ninterface UnifiedChartProps {\r\n  type: ChartType\r\n  data: any[]\r\n  config: ChartConfig\r\n  dataKey: string\r\n  xAxisKey: string\r\n  title?: string\r\n  description?: string\r\n  className?: string\r\n  footer?: React.ReactNode\r\n}\r\n\r\nconst getRandomColor = () => {\r\n  const h = Math.floor(Math.random() * 360);\r\n  return `hsl(${h}, 70%, 50%)`;\r\n};\r\n\r\nconst resolveColor = (color: string | undefined) => {\r\n    if (!color) return color;\r\n    if (typeof window === 'undefined') return color;\r\n    \r\n    if (color.includes('var(') || color.includes('hsl') || color.includes('rgb') || color.includes('oklch')) {\r\n        const div = document.createElement('div');\r\n        div.style.color = color;\r\n        div.style.display = 'none'; \r\n        document.body.appendChild(div);\r\n        const computedColor = window.getComputedStyle(div).color;\r\n        document.body.removeChild(div);\r\n        return computedColor || color;\r\n    }\r\n    return color;\r\n}\r\n\r\nexport function UnifiedChart({\r\n  type,\r\n  data,\r\n  config,\r\n  dataKey,\r\n  xAxisKey,\r\n  title,\r\n  description,\r\n  className,\r\n  footer,\r\n}: UnifiedChartProps) {\r\n  \r\n  const chartData = React.useMemo<ChartData<any>>(() => {\r\n    const labels = data.map((item) => item[xAxisKey])\r\n    \r\n    const backgroundColors = data.map((item) => {\r\n        const key = item[xAxisKey]?.toString().toLowerCase()\r\n        const itemColor = config[key]?.color\r\n        const seriesColor = config[dataKey]?.color\r\n        if (type === 'pie') {\r\n            return resolveColor(itemColor) || getRandomColor()\r\n        }\r\n        return resolveColor(itemColor || seriesColor) || resolveColor(\"hsl(var(--primary))\") || getRandomColor() \r\n    })\r\n\r\n    const borderColors = backgroundColors\r\n\r\n    const dataset = {\r\n      label: config[dataKey]?.label || title || \"Data\",\r\n      data: data.map((item) => item[dataKey]),\r\n      backgroundColor: type === \"line\" || type === \"area\" ? config[dataKey]?.color || \"hsl(var(--primary))\" : backgroundColors,\r\n      borderColor: type === \"line\" || type === \"area\" ? config[dataKey]?.color || \"hsl(var(--primary))\" : borderColors,\r\n      borderWidth: 1,\r\n      fill: type === \"area\", \r\n      tension: 0.4, \r\n    }\r\n\r\n    return {\r\n      labels,\r\n      datasets: [dataset],\r\n    }\r\n  }, [data, xAxisKey, dataKey, config, type, title])\r\n\r\n  const options = React.useMemo<ChartOptions<any>>(() => {\r\n    return {\r\n      responsive: true,\r\n      maintainAspectRatio: false,\r\n      plugins: {\r\n        legend: {\r\n          display: type === \"pie\", \r\n          position: 'bottom' as const,\r\n        },\r\n        tooltip: {\r\n            callbacks: {\r\n                label: (context: TooltipItem<any>) => {\r\n                    let label = (type === 'pie' ? context.label : context.dataset.label) || '';\r\n                    \r\n                    if (label) {\r\n                        label += ': ';\r\n                    }\r\n                    if (context.formattedValue !== undefined) {\r\n                        label += context.formattedValue;\r\n                    }\r\n                    return label;\r\n                }\r\n            }\r\n        },\r\n        title: {\r\n            display: false, \r\n        }\r\n      },\r\n      scales: type === \"pie\" ? {\r\n        x: { display: false },\r\n        y: { display: false }\r\n      } : {\r\n        x: {\r\n          grid: {\r\n            display: false,\r\n          },\r\n        },\r\n        y: {\r\n          grid: {\r\n            color: \"rgba(0,0,0,0.1)\", \r\n            borderDash: [3, 3],\r\n          },\r\n          border: {\r\n             display: false\r\n          }\r\n        },\r\n      },\r\n    }\r\n  }, [type])\r\n\r\n  const ChartComponent = React.useMemo(() => {\r\n    switch (type) {\r\n      case \"bar\":\r\n        return Bar\r\n      case \"line\":\r\n        return Line\r\n      case \"area\":\r\n        return Line \r\n      case \"pie\":\r\n        return Pie\r\n      default:\r\n        return Bar\r\n    }\r\n  }, [type])\r\n\r\n  return (\r\n    <div className={cn(\"flex flex-col gap-4\", className)}>\r\n      {(title || description) && (\r\n        <div className=\"flex flex-col gap-1\">\r\n          {title && <h3 className=\"text-lg font-semibold leading-none tracking-tight\">{title}</h3>}\r\n          {description && <p className=\"text-sm text-muted-foreground\">{description}</p>}\r\n        </div>\r\n      )}\r\n      \r\n      <div className=\"min-h-[200px] w-full h-[300px] relative\">\r\n         <ChartComponent data={chartData} options={options} />\r\n      </div>\r\n      \r\n      {footer && <div className=\"text-sm text-muted-foreground pt-4 border-t\">{footer}</div>}\r\n    </div>\r\n  )\r\n}\r\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}